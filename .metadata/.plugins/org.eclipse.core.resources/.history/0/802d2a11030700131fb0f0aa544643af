package map;

import java.awt.Point;
import java.awt.Rectangle;
import java.util.ArrayList;
import java.util.HashMap;

import math.Util;

public class Dungeon
{
	// Parameters
	
	public static final int NUM_CELLS = 150;
	public static final int ROOM_DIM_MIN = 4;
	public static final int ROOM_DIM_MAX = 9;
	public static final int ROOM_RADIUS = (int)(NUM_CELLS / 20);
	
	
	ArrayList<Rectangle> rooms;
	
	public Dungeon()
	{
		rooms =  new ArrayList<Rectangle>();
	}
	
	private void generate()
	{
		generateRooms();
	}
	
	private void generateRooms()
	{
		Point currentPoint = new Point(0,0);
		
		for (int q = 0; q < NUM_CELLS; q++)
		{
			double theta = (Math.random() * 2 * Math.PI);
			int width = Util.gaussian(ROOM_DIM_MIN, ROOM_DIM_MAX);
			int height = Util.gaussian(ROOM_DIM_MIN, ROOM_DIM_MAX);
			int x = currentPoint.x + (int)(Math.cos(theta));
			int y = currentPoint.y + (int)(Math.sin(theta));
			
			rooms.add(new Rectangle(x, y, width, height));
		}
	}
	
	private void drift()
	{
		HashMap<Rectangle, Point> velocity = new HashMap<Rectangle, Point>();
		
		for (Rectangle r : rooms)
		{
			velocity.put(r, new Point(0,0));
		}
		
		while (collisionsExist())
		{
			for (Rectangle r : rooms)
			{
				for (Rectangle s : rooms)
				{
					if (s.intersects(r))
					{
						Point rp = velocity.get(r);
						Point sp = velocity.get(s);
						Point rv = driftVector(r, s);
						Point sv = driftVector(s, r);
						velocity.put(r, new Point(rv.x + rp.x, rv.y + rp.y));
						velocity.put(s, new Point(sv.x + sp.x, sv.y + sp.y));
					}
				}
			}
			
			for (Rectangle r : rooms)
			{
				r.x += velocity.get(r).x;
				r.y += velocity.get(r).y;
			}
		}
	}
	
	private Point driftVector(Rectangle r, Rectangle s)
	{
		int x = (r.x < s.x) ? -1 : 1;
		int y = (r.y < s.y) ? -1 : 1;
		return new Point (x, y);
	}
	
	private boolean collisionsExist()
	{
		for (Rectangle r : rooms)
		{
			for (Rectangle s : rooms)
			{
				if (r.intersects(s))
				{
					return true;
				}
			}
		}
		
		return false;
	}
}
